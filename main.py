import streamlit as st
from PIL import Image
import folium
from streamlit_folium import st_folium

# ì¥ì†Œë³„ ìœ„ë„/ê²½ë„ ì •ë³´
place_coords = {
    "ì¹´í˜ê±°ë¦¬ (ì—°ë‚¨ë™)": [37.5660, 126.9237],
    "í™ëŒ€ í”„ë¦°íŠ¸ë² ì´ì»¤ë¦¬": [37.5563, 126.9258],
    "ë””ë®¤ì§€ì—„ (ì„±ìˆ˜)": [37.5464, 127.0550],
    "ì„±ìˆ˜ ì¹´í˜ê±°ë¦¬": [37.5447, 127.0565],
    "ì„œìš¸ìˆ²": [37.5444, 127.0370],
    "ì”¨ë„¤í ì„±ìˆ˜": [37.5442, 127.0547],
    "ì±…ì½ëŠ” ê³µê°„ ìœ„íŠ¸ì•¤ì‹œë‹ˆì»¬": [37.5625, 126.9369],
    "ì„œìš¸ì±…ë³´ê³ ": [37.5383, 127.0017],
    "ì´í™” ë²½í™”ë§ˆì„": [37.5774, 127.0036],
    "í˜œí™” ì‹œì§‘ì„œì ": [37.5822, 127.0025],
    "ì„±ìˆ˜ë™ ì„œìš¸ìˆ²ê¸¸ ë§ˆì¼“": [37.5462, 127.0422],
    "ì–¸ë”ìŠ¤íƒ ë“œ ì—ë¹„ë‰´": [37.5433, 127.0465],
    "ëŒ€í•™ë¡œ ì†Œê·¹ì¥ ê±°ë¦¬": [37.5825, 127.0021],
    "ë‚™ì‚°ê³µì›": [37.5796, 127.0079],
    "í™ëŒ€ ê±·ê³ ì‹¶ì€ ê±°ë¦¬": [37.5573, 126.9245],
    "í™ëŒ€ í”„ë¦¬ë§ˆì¼“": [37.5571, 126.9229],
    "ë¡¯ë°ì›”ë“œ": [37.5110, 127.0980],
    "ì„ì´Œí˜¸ìˆ˜ ë ˆìŠ¤í† ë‘": [37.5109, 127.1042],
    "ë”í´ë¼ì´ë° í™ëŒ€": [37.5565, 126.9225],
    "ë¹„ê±´ì‹ë‹¹ ëŸ¬ë¹™í—›": [37.5562, 126.9270],
    "ì½”ì—‘ìŠ¤ ì•„ì¿ ì•„ë¦¬ì›€": [37.5125, 127.0592],
    "êµ­ë¦½ê³¼ì²œê³¼í•™ê´€": [37.4337, 126.9966],
    "ë§ë¦¬ë‹¨ê¸¸": [37.5496, 126.9114],
    "ì„œìš¸ì‹œë¦½ì²œë¬¸ëŒ€": [37.6039, 127.1043],
    "í™ëŒ€ VRíŒŒí¬": [37.5553, 126.9239],
    "ì‚¼ì„±ì „ì í™ëŒ€ í”Œë˜ê·¸ì‹­": [37.5551, 126.9234],
    "ë°˜í¬ í•œê°•ê³µì›": [37.5123, 126.9956],
    "ì„¸ë¹›ì„¬ ê°¤ëŸ¬ë¦¬": [37.5209, 126.9905],
    "ì„œìš¸ëœë“œ": [37.4355, 127.0096],
    "ë‚¨ë¬¸ì‹œì¥": [37.4352, 127.0176],
    "ìš©ì‚° êµ­ë¦½ì¤‘ì•™ë°•ë¬¼ê´€": [37.5230, 126.9804],
    "í•œë‚¨ë™ ë ˆìŠ¤í† ë‘": [37.5270, 127.0008]
}

# Streamlit ì•± ì„¤ì •
st.set_page_config(page_title="MBTI ì»¤í”Œ ê¶í•© ì¶”ì²œ ğŸ’˜", page_icon="ğŸ’‘", layout="wide")

# í—¤ë” ì˜ì—­
st.markdown("""
    <h1 style='text-align: center; color: #ff69b4;'>ğŸ’ MBTI ê¶í•© ì¶”ì²œ ì›¹ì•± ğŸ’</h1>
    <h3 style='text-align: center;'>ë‹¹ì‹ ì˜ ì„±ê²© ìœ í˜•ì— ë§ëŠ” ìµœê³ ì˜ ì»¤í”Œ ë§¤ì¹­ì„ ì•Œì•„ë³´ì„¸ìš”! ğŸŒŸ</h3>
""", unsafe_allow_html=True)

# ì‚¬ì´ë“œë°” ì„¤ì •
st.sidebar.header("ğŸ“Œ ì‚¬ìš© ë°©ë²•")
st.sidebar.write("MBTI ìœ í˜•ì„ ì„ íƒí•˜ë©´ ê¶í•© ì¢‹ì€ ì»¤í”Œ ìœ í˜•ê³¼ ë°ì´íŠ¸ ì½”ìŠ¤ë¥¼ ì¶”ì²œí•´ì¤˜ìš”!")
selected_mbti = st.sidebar.selectbox("ë‹¹ì‹ ì˜ MBTI ìœ í˜•ì€ ë¬´ì—‡ì¸ê°€ìš”? ğŸ§¬", list(mbti_matches.keys()))

# ë©”ì¸ ì½˜í…ì¸ 
st.markdown("""
<div style='text-align: center;'>
    <img src='https://media.giphy.com/media/26FPpP8K0vBSF7rNu/giphy.gif' width='300'>
</div>
""", unsafe_allow_html=True)

st.markdown(f"## ğŸ’Œ ë‹¹ì‹ ì˜ MBTIëŠ” **:rainbow[{selected_mbti}]**!")

if selected_mbti in mbti_matches:
    match = mbti_matches[selected_mbti]
    st.markdown(f"### ğŸ’˜ ê°€ì¥ ì˜ ì–´ìš¸ë¦¬ëŠ” ì»¤í”Œ ìœ í˜•: **{match['match']}**")
    st.markdown(f"#### ğŸ’¡ ì´ìœ : {match['reason']}")
    st.markdown(f"#### ğŸ’‘ ì¶”ì²œ ë°ì´íŠ¸ ì½”ìŠ¤: {match['date']}")
    st.markdown(f"#### ğŸ“ ì¶”ì²œ ì¥ì†Œ: {', '.join(match['places'])}")

    for place in match['places']:
        st.markdown(f"##### ğŸ—ºï¸ ì¥ì†Œ ì§€ë„ ë³´ê¸°: **{place}**")
        if place in place_coords:
            lat, lon = place_coords[place]
            map_view = folium.Map(location=[lat, lon], zoom_start=15)
            folium.Marker([lat, lon], popup=place).add_to(map_view)
            st_folium(map_view, width=700, height=400)
        else:
            st.warning(f"ìœ„ì¹˜ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: {place}")
else:
    st.warning("í•´ë‹¹ MBTIì— ëŒ€í•œ ì»¤í”Œ ì¶”ì²œ ì •ë³´ê°€ ì•„ì§ ì—†ìŠµë‹ˆë‹¤. ğŸ™")

# í•˜ë‹¨ ì˜ì—­
st.markdown("""
---
<center>Made with â¤ï¸ by Streamlit & GPT</center>
""", unsafe_allow_html=True)
